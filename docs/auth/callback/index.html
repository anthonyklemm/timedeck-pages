<!doctype html>
<meta charset="utf-8">
<title>TapeDeck – Finishing Sign-in…</title>
<style>body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:24px;}</style>
<p>Finishing sign-in…</p>
<script>
  // Copy the full query (?token=... etc)
  var qs = location.search || "";
  // If the native flag is present, bounce back into the app via custom scheme:
  if (qs.includes('native=1')) {
    // Try to open the native app with the same querystring (so token comes along)
    var deep = 'com.tapedecktimemachine.app://auth/callback' + qs;
    // Use replace() so Safari view is closed after handoff
    location.replace(deep);
  } else {
    // Web case: show a small link back to the app page, or just close the window if it was a popup
    document.body.insertAdjacentHTML('beforeend',
      '<p>You can close this tab and return to TapeDeck.</p>');
  }
</script>
